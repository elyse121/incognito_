{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %} Chat Admin Dashboard {% endblock %}</title>
  <link rel="icon" type="image/x-icon" href="{% static 'images/bbbm.ico' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- CSS (Django static) -->
  <link href="{% static 'DASHBOARD/CSS/index.css' %}" rel="stylesheet">

</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar d-flex flex-column" id="sidebar">
    <h4 class="text-center py-3">Admin Panel</h4>
    <nav class="nav flex-column">
      <a href="#" class="nav-link">
        <i class="bi bi-display"></i>
        <span class="nav-text">Dashboard</span>
      </a>

      <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#reportsMenu">
        <span>
          <i class="bi bi-people-fill"></i>
            <span class="nav-text">Manage Users</span>
        </span>
        <i class="bi bi-chevron-right toggle-arrow"></i>
      </a>
      <div class="collapse sub-menu" id="reportsMenu">
        <a href="{% url 'manage_members_api' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">All Members</span>
        </a>
        <a href="#" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Banned Users</span>
        </a>
      </div>

      <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#icoMenu">
        <span>
          <i class="bi bi-discord"></i>
          <span class="nav-text">Chat Monitoring</span>
        </span>
        <i class="bi bi-chevron-right toggle-arrow"></i>
      </a>
      <div class="collapse sub-menu" id="icoMenu">
        <a href="{% url 'chatprvate' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Private Messages</span>
        </a>
        <a href="{% url 'groupchats' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Group Chat</span>
        </a>
        <a href="{% url 'darkmessages' %}" class="nav-link">
          <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
          <span class="nav-text">Dark Messages</span>
        </a>
      </div>

      <a href="{% url 'reportemessages' %}" class="nav-link">
        <i class="bi bi-flag-fill"></i>
        <span class="nav-text">Reported Messages</span>
      </a>
      <a href="{% url 'user_activities' %}" class="nav-link">
        <i class="bi bi-activity"></i>
        <span class="nav-text">User Activity</span>
      </a> 
      <a href="#" class="nav-link">
        <i class="bi bi-people-fill"></i>
        <span class="nav-text">Manage Rooms/Groups</span>
      </a>
      <a href="{% url 'view_notifications' %}" class="nav-link">
        <i class="bi bi-chat-dots-fill"></i>
        <span class="nav-text">Messages</span>
      </a>
      <a href="{% url 'privacydash' %}" class="nav-link">
        <i class="bi bi-lock-fill"></i>
        <span class="nav-text">Privacy</span>
      </a>
      <a href="{% url 'reportedposts' %}" class="nav-link">
        <i class="bi bi-kanban-fill"></i>
        <span class="nav-text">Manage Posts</span>
      </a>
    </nav>

    <!-- User Section -->
    <div class="user-section">
    <h5>{{ request.user.username }}</h5>
    <p>Administrator</p>
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn btn btn-danger">Logout</button>
    </form>
</div>


    <!-- Copyright -->
    <div class="copyright">
      <div>Chat Admin Dashboard</div>
      <div>Â© 2025 All Rights Reserved</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Header -->
    <div class="header-bar">
      <div class="header-controls">
        <!-- Left side controls -->
        <div class="header-control-group">
          <button class="header-icon-btn" id="toggleSidebar">
            <i class="bi bi-list"></i>
            <span class="tooltip">Toggle Sidebar</span>
          </button>
          <button class="header-icon-btn" id="messagesBtn">
            <i class="bi bi-chat-left-dots"></i>
            <span class="tooltip">Messages</span>
          </button>
          <button class="header-icon-btn" id="mentionsBtn">
            <i class="bi bi-at"></i>
            <span class="tooltip">Mentions</span>
          </button>
          <button class="header-icon-btn" id="clipboardBtn">
            <i class="bi bi-clipboard"></i>
            <span class="tooltip">Clipboard</span>
          </button>
        </div>

        <!-- Search bar -->
        <div class="header-search">
          <i class="bi bi-search"></i>
          <input type="text" class="search-input" id="globalSearch" placeholder="Search...">
          <button class="search-btn" id="searchButton">
            <i class="bi bi-arrow-right" style="margin-left: -20px;"></i>
          </button>
        </div>

        <!-- Right side controls -->
        <div class="header-control-group">
          <button class="header-icon-btn" id="fullscreenBtn">
            <i class="bi bi-fullscreen"></i>
            <span class="tooltip">Fullscreen</span>
          </button>
          <button class="header-icon-btn notification-btn" id="notificationsBtn">
    <i class="bi bi-bell"></i>
    <span class="notification-badge" id="notificationCount">0</span>
    <span class="tooltip">Notifications</span>
</button>

<script>
// Function to load notification count
function loadNotificationCount() {
    fetch('/get_notification_count/')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            updateNotificationCount(data.count);
        })
        .catch(error => {
            console.error('Error fetching notification count:', error);
        });
}

// Function to update notification badge count
function updateNotificationCount(count) {
    const badge = document.getElementById('notificationCount');
    if (badge) {
        badge.textContent = count;
        
        // Show/hide badge based on count
        if (count > 0) {
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }
}

// Load notification count when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadNotificationCount();
    
    // Optional: Refresh count every 60 seconds
    setInterval(loadNotificationCount, 60000);
});
</script>
          <div class="user-avatar" id="userProfile">
            <img src="{% static 'DASHBOARD/pics/me.jpg' %}" alt="User Avatar">
            <span class="tooltip">Profile</span>
          </div>
          <button class="header-icon-btn" id="settingsBtn">
            <i class="bi bi-gear"></i>
            <span class="tooltip">Settings</span>
          </button>
        </div>
      </div>
    </div>

  {% block content %}

    <!-- Dashboard Content -->

    <div class="container-fluid p-4">
  <h1 class="mt-4 mb-4">Chat Dashboard Overview</h1>

  <!-- Stats Cards Row -->
  <div class="row g-4 mb-4">
    <!-- Total Users Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Total Users</h6>
              <h2 class="mb-0" id="totalUsersCount">{{ total_users }}</h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-up"></i> 12.5%
              </span>
              <span class="text-muted small ms-2">vs last month</span>
            </div>
            <div class="icon icon-shape bg-gradient-primary text-white rounded-circle shadow">
              <i class="bi bi-people-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Active Conversations Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Active Chats</h6>
              <h2 class="mb-0">20</h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-up"></i> 2%
              </span>
              <span class="text-muted small ms-2">vs last month</span>
            </div>
            <div class="icon icon-shape bg-gradient-info text-white rounded-circle shadow">
              <i class="bi bi-chat-dots-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Messages Today Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Messages Today</h6>
              <h2 class="mb-0">5</h2>
              <span class="text-danger fw-bold small">
                <i class="bi bi-arrow-down"></i> 3%
              </span>
              <span class="text-muted small ms-2">vs yesterday</span>
            </div>
            <div class="icon icon-shape bg-gradient-warning text-white rounded-circle shadow">
              <i class="bi bi-envelope-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Avg Response Time Card -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-stats">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-uppercase text-muted mb-1">Avg Response</h6>
              <h2 class="mb-0">1.8 <small class="fs-6">min</small></h2>
              <span class="text-success fw-bold small">
                <i class="bi bi-arrow-down"></i> 15.7%
              </span>
              <span class="text-muted small ms-2">improvement</span>
            </div>
            <div class="icon icon-shape bg-gradient-success text-white rounded-circle shadow">
              <i class="bi bi-stopwatch-fill"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row g-4">
<!-- User Activity Chart -->
<div class="col-lg-6">
  <div class="card card-chart">
    <div class="card-header bg-transparent">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">User Activity</h6>
        <div class="dropdown">
          <button class="btn btn-sm btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
            This Month
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Today</a></li>
            <li><a class="dropdown-item" href="#">This Week</a></li>
            <li><a class="dropdown-item" href="#">This Month</a></li>
            <li><a class="dropdown-item" href="#">This Year</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="chart-container" style="height: 300px;">
        <canvas id="userActivityChart" style="height: 300px;"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Make sure Django context variables are JSON encoded
    // Use JSON-parsed values from script tags to avoid redeclaration errors

    const ctx = document.getElementById('userActivityChart').getContext('2d');
    const userActivityChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: JSON.parse(document.getElementById('labels-json').textContent),
            datasets: [{
                label: 'User Activity',
                data: JSON.parse(document.getElementById('data-json').textContent),
                borderColor: 'rgba(78, 115, 223, 1)',
                backgroundColor: 'rgba(78, 115, 223, 0.1)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: 'rgba(78, 115, 223, 1)',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    stepSize: 1
                },
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
</script>

    <!-- Conversation Metrics Chart -->
    <div class="col-lg-6">
      <div class="card card-chart">
        <div class="card-header bg-transparent">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Conversation Metrics</h6>
            <div class="dropdown">
              <button class="btn btn-sm btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown">
                By Day
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">By Hour</a></li>
                <li><a class="dropdown-item" href="#">By Day</a></li>
                <li><a class="dropdown-item" href="#">By Week</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container" style="height: 300px;">
            <!-- Chart will be inserted here -->
            <div class="d-flex justify-content-center align-items-center h-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity Row -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">Recent Chat Activity</h6>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-items-center mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">User</th>
                  <th>Status</th>
                  <th>Last Message</th>
                  <th>Time</th>
                  <th>Agent</th>
                  <th class="text-end pe-4">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Sarah Johnson</h6>
                        <small class="text-muted">sarah@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-success">Active</span></td>
                  <td>How do I reset my password?</td>
                  <td>2 min ago</td>
                  <td>Alex Chen</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">View</button>
                  </td>
                </tr>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Michael Brown</h6>
                        <small class="text-muted">michael@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-warning">Pending</span></td>
                  <td>I have a question about my subscription</td>
                  <td>15 min ago</td>
                  <td>Unassigned</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">Assign</button>
                  </td>
                </tr>
                <tr>
                  <td class="ps-4">
                    <div class="d-flex align-items-center">
                      <!---<img src="D:\Python\newcode\pics\me.jpg" class="rounded-circle me-2" alt="user">--->
                      <div>
                        <h6 class="mb-0">Emma Wilson</h6>
                        <small class="text-muted">emma@example.com</small>
                      </div>
                    </div>
                  </td>
                  <td><span class="badge bg-secondary">Closed</span></td>
                  <td>Thank you for your help!</td>
                  <td>1 hour ago</td>
                  <td>Jamie Lee</td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-primary">Reopen</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

  <!-- Settings Panel Overlay -->
  <div class="settings-overlay" id="settingsOverlay"></div>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h3 class="settings-title">Settings</h3>
      <button class="close-settings" id="closeSettings">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Appearance</h4>
      <div class="theme-options">
        <div class="theme-option light-theme" id="lightTheme">
          <i class="bi bi-sun-fill theme-icon-large"></i>
          <div>Light</div>
        </div>
        <div class="theme-option dark-theme" id="darkTheme">
          <i class="bi bi-moon-stars-fill theme-icon-large"></i>
          <div>Dark</div>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Layout</h4>
      <div class="rtl-toggle">
        <span>Right-to-Left (RTL)</span>
        <label class="toggle-switch">
          <input type="checkbox" id="rtlToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <div class="settings-section">
      <h4 class="settings-section-title">Sidebar</h4>
      <div class="rtl-toggle">
        <span>Toggle Sidebar</span>
        <label class="toggle-switch">
          <input type="checkbox" id="sidebarToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="rtl-toggle">
        <span>Right Sidebar Slide</span>
        <label class="toggle-switch">
          <input type="checkbox" id="rightSidebarToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
  </div>

  <!----bootstrap js --->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!---- JS for mine 
  <script src="D:\Python\newcode\JS\index.js"></script>
  ---->

  <!-- JS -->
  <script src="{% static 'DASHBOARD/JS/index.js' %}"></script>
</body>
</html>